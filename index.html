<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            overflow: hidden;
        }
        #player {
            position: absolute;
            top: 50vh;
            left: 50vw;
        }

        #player img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes walking {
            0% {
                bottom: 0;
                transform: rotateZ(10deg);
            }

            25% {
                bottom: 10px;
            }

            50% {
                bottom: 0;
                transform: rotateZ(-10deg);
            }

            75% {
                bottom: 10px;
            }

            100% {
                bottom: 0;
                transform: rotateZ(10deg);
            }
        }

        .walking {
            position: absolute;
            animation-name: walking;
            animation-duration: 0.2s;
            animation-iteration-count: infinite;
        }

        .flipped {
            transform: scaleX(-1);
        }

        .grid-container {
            position: absolute;
            display: grid;
            /* grid-template-columns: auto auto auto auto auto auto; */
            grid-template-rows: 50;
        }

        .grid-item {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.8);
            width: 100px;
            height: 100px;
            font-size: 30px;
            text-align: center;
        }
        #tiles{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            width: max-content;
            height: max-content;
        }

        #tiles table{
            border-spacing: -0.5;
            border-collapse: collapse;
        }

        #tiles tr{
            height: 50px;
        }

        #tiles td{
            border: 1px solid;
            width: 50px;
            height: 50px;
        }

    </style>
</head>

<body>
    <pre id="monitor">

    </pre>
    <div id="player">
        <div id="scale">
            <div class="walking" id="offset">
                <img src="person.png" alt="" srcset="">
            </div>
        </div>
    </div>
    <div id="tiles">
    </div>
</body>
<script>
    const position = { x: 0, y: 0 };
    const velocity = { x: 0, y: 0 };
    const worldPosition = {x:0, y:0};

    const calculatedVelocity = { x: 0, y: 0 };
    const mapTiles = document.getElementById("tiles");
    const monitor = document.getElementById("monitor");
    const playerOffset = document.getElementById("offset");
    const playerScale = document.getElementById("scale");

    const walkSpeed = 3;

    const tileSize = 21;
    let seed = 5000;

    let tiles = null;

    function generateGrid(size){
        let table = document.createElement("table");
        for(let i = 0; i< size;i++){
            let row = table.insertRow()
            for(let j = 0; j < size; j++){
                let cell = row.insertCell();
            }
        }
        return table;
    }

    function setTileNumber(xOffset,yOffset){
        
    }



    function mulberry32(a) {
        return function () {
            var t = a += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    function getFakeRandom(seed, x, y) {
        let xVal = (mulberry32(x / (seed || 1)))();
        let yVal = (mulberry32(y / (seed || 1)))();
        return (xVal + yVal) / 2;
    }

    document.onkeydown = (e) => {
        switch (e.key) {
            case "w":
            case "ArrowUp":
                velocity.y = 1;
                break;
            case "s":
            case "ArrowDown":
                velocity.y = -1;
                break;
            case "a":
            case "ArrowLeft":
                velocity.x = -1;
                break;
            case "d":
            case "ArrowRight":
                velocity.x = 1
                break;
        }
        if (velocity.x != 0 && velocity.y != 0) {
            calculatedVelocity.x = velocity.x * sqrtBar;
            calculatedVelocity.y = velocity.y * sqrtBar;
        } else {
            calculatedVelocity.x = velocity.x;
            calculatedVelocity.y = velocity.y;
        }
        // monitor.innerHTML = JSON.stringify(calculatedVelocity);
    }
    document.onkeyup = (e) => {
        switch (e.key) {
            case "w":
            case "ArrowUp":
            case "s":
            case "ArrowDown":
                velocity.y = 0;
                break;
            case "a":
            case "ArrowLeft":
            case "d":
            case "ArrowRight":
                velocity.x = 0;
                break;
        }
        if (velocity.x != 0 && velocity.y != 0) {
            calculatedVelocity.x = velocity.x * sqrtBar;
            calculatedVelocity.y = velocity.y * sqrtBar;
        } else {
            calculatedVelocity.x = velocity.x;
            calculatedVelocity.y = velocity.y;
        }
        
    }

    const sqrtBar = 0.707



    const frame = () => {
        if (calculatedVelocity.x != 0 || calculatedVelocity.y != 0) {
            playerOffset.classList.toggle("walking", true);
        } else {
            playerOffset.classList.toggle("walking", false);
        }
        if (calculatedVelocity.x > 0) {
            playerScale.classList.toggle("flipped", true);
        } else if (calculatedVelocity.x < 0) {
            playerScale.classList.toggle("flipped", false);
        }

        worldPosition.x += calculatedVelocity.x * walkSpeed;
        worldPosition.y += calculatedVelocity.y * walkSpeed;
        tiles.style.transform = `translate(${-worldPosition.x % 50}px, ${worldPosition.y % 50}px)`;
        monitor.innerHTML = JSON.stringify(calculatedVelocity) + "\n" + JSON.stringify(worldPosition);
    }

    const init = ()=>{
        tiles = generateGrid(tileSize)
        mapTiles.append(tiles);
        setInterval(frame, 10);
    }

    init();

</script>

</html>